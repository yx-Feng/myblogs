### 1. MySQL事务的四大特性ACID

事务：把一组密不可分的操作系列集合在一起，这些操作要么全部执行，要么全部不执行。

- 原子性（Atomicity）：事务是内定义的操作是一个整体，是不可分割的。  

- 一致性（Consistency）：同一个事务，多次读取数据库中的同一个数据，读取的内容应该是一致的，不变的。  

- 隔离性（Isolation）：不同事务之间相互独立，互不干扰。  

- 持久性（Durability）：事务提交后，事务内的操作对数据库的修改被永久保存在数据库文件中。

### 2. SQL注入攻击

SQL注入（SQL Injection）是一种常见的网络攻击方式，攻击者通过在应用程序的输入字段中注入恶意SQL代码来访问或篡改数据库中的数据。攻击的核心在于将恶意代码拼接到SQL查询中，执行未预期的数据库操作。

- 通过参数化查询避免将用户输入直接拼接到SQL语句中。

- 最小化数据库权限：限制数据库用户权限，确保即使SQL注入成功，数据库损失最小。

### 3. 非关系型数据库

**键值存储**：Redis、 Amazon DynamoDB。

**文档存储**：MongoDB

**图形数据库**：Neo4j

**优点**：

- **可扩展性**：通常很容易通过增加更多的节点来扩展数据库。
- **灵活性**：数据模型更加灵活，可以存储各种结构的数据。
- **性能**：在处理大量数据和高并发请求时，性能通常优于关系型数据库。

### 4. 线程池的工作原理

线程池通过复用固定数量的线程来执行多个任务，避免了频繁创建和销毁线程带来的开销，提高了资源利用率。

**执行流程**：

- 当一个新任务提交到线程池时，首先会判断是否可以使用已有的核心线程执行任务。如果核心线程未满，则创建新的线程来处理任务。
- 当核心线程已满时，任务会被放入任务队列中，等待线程池中空闲的线程来执行。
- 如果任务队列也满了，则会尝试创建新的线程（但总线程数不能超过最大线程数）。
- 如果线程总数已达到最大线程数并且任务队列已满，则根据拒绝策略来处理任务。

### 5. mysql为什么要索引？索引的好处？

MySQL中的索引是一种用于快速定位数据的技术。索引可以显著提高数据库的查询效率，尤其是在处理大型数据集时。

### 6. Mysql 数据库的架构是怎样的

MySQL 数据库的架构是一个层次化的系统结构，通常可以分为三大层：连接层、服务层和存储引擎层。

**连接层**

- **功能**：主要负责客户端连接管理和安全认证。该层接收来自客户端的请求并管理连接、权限验证、会话处理等。
- **连接池**：为了减少频繁的连接开销，MySQL 提供了连接池来复用现有连接。典型的通信协议包括 TCP/IP 协议等。
- **线程管理**：MySQL 为每个客户端连接创建一个线程，这个线程负责处理该连接的所有操作。

**服务层**

- **查询解析**：这一层会对 SQL 查询进行解析、预处理，并生成查询执行计划。包括 SQL 语法解析和语义检查。
- **查询优化**：查询优化器会根据表的结构、索引、统计信息等对查询进行优化，选择最优的执行方案。比如决定是用索引还是全表扫描。
- **缓存和查询结果**：MySQL 可以缓存查询的结果，对于重复查询返回缓存数据，而不需要重新执行查询。
- **事务管理**：MySQL 支持事务，通过事务管理器负责对事务的控制，包括提交、回滚、锁定等操作，以保证数据一致性。
- **权限控制**：在这个层级 MySQL 也会对客户端的权限进行校验，确保用户只能访问被授权的数据。

**存储引擎层**

- **存储引擎接口**：MySQL 的存储引擎层是其架构的核心，存储引擎接口提供了一个抽象层，应用程序可以通过统一接口访问底层存储引擎，具备高扩展性。
- **不同存储引擎**：MySQL 支持多种存储引擎（如 InnoDB、MyISAM、Memory、NDB 等），每个引擎的实现和特点不同，例如：
  - **InnoDB**：默认的事务型存储引擎，支持事务、行级锁以及崩溃恢复机制，适用于高并发、需要事务控制的场景。
  - **MyISAM**：不支持事务，采用表级锁，性能较高但不具备数据一致性保障，适合只读应用场景。
  - **Memory**：数据存储在内存中，速度快，但数据断电后会丢失，适用于临时数据的处理。
- **日志和恢复**：存储引擎还负责具体的数据存储和检索，并通过日志机制提供数据的恢复功能。

### 7. MySQL 索引的数据结构

**索引**是存储引擎用于快速查找数据记录的一种数据结构。

索引的数据结构：B+树。

**二叉查找树**：任何节点的键值，大于左子节点的键值，小于右子节点的键值。

**二叉平衡树**：基于二叉查找树，要求每个节点的左右子树的高度差不超过1。

**B树(Balance Tree)**：基于二叉平衡树，单个节点可以存储多个键值和数据。（考虑到表的数据和索引一般存储在磁盘中，如果使用平衡二叉树作为索引的数据结构，每查找一次数据就需要从磁盘中读取一个节点，如果要存的数据很多，则二叉树的节点就很多，查找数据时磁盘IO就比较多，查询效率低）

**B+树**：对B树的进一步优化，B+树非叶子节点上是不存储数据的，仅存储键值。（因为在数据库中页的大小是固定的，如果不存储数据，那么就会存储更多的键值，相应的树的阶数就会更大，树就会更矮更胖，查找数据进行磁盘的IO次数有会再次减少）

### 8. 脏读 不可重复读 幻读 分别是什么，如何预防

**脏读**：是指一个事务读取到了另一个事务尚未提交的修改。由于该数据是未提交的临时数据，后续可能会被撤销或修改，导致读取数据不一致。

**不可重复读**：不可重复读是指在同一个事务中，两次读取同一数据却得到了不同的结果。这通常是因为在两次读取之间，另一事务修改了该数据并提交了，导致数据发生变化。

**幻读**：指一个事务在两次读取过程中，因另一事务的插入或删除操作，导致第一次读取的数据集与第二次读取的数据集不同。

**预防**

使用锁机制

- **行级锁（Row Lock）**：仅锁定当前操作的行，适合需要高并发且频繁操作的场景，可以防止并发操作导致的数据不一致。

- **表级锁（Table Lock）**：锁定整张表，通常用于批量更新的场景，避免其他事务的并发干扰，但会影响并发性能。

- **共享锁（S Lock）**：允许多个事务并发读，不允许写操作。适合读多写少的场景，防止脏读。

- **排他锁（X Lock）**：排他锁只允许单一事务操作数据，可以防止脏读和不可重复读，但会显著降低并发能力。

MVCC（多版本并发控制）

- 可以通过**保存数据的多个版本**来避免不可重复读和幻读，广泛应用于MySQL InnoDB等数据库引擎。

### 9. MySQL中的事务隔离级别

MySQL 提供了四种事务隔离级别，从低到高分别是：

- 读未提交（Read Uncommitted）：事务可以读取其他事务未提交的数据（脏读）。

- 读已提交（Read Committed）：一个事务只能读取其他事务已提交的数据，避免了脏读，但仍可能出现不可重复读和幻读问题。

- 可重复读（Repeatable Read）（MySQL 默认级别）：保证在一个事务内多次读取同一数据的结果是一样的，即避免了不可重复读问题。

- 可串行化（Serializable）：最高的隔离级别，事务按顺序执行，类似加了全表锁。

### 10. 查询当前数据库的事务隔离级别的命令

查看当前会话（SESSION）事务隔离级别：

```
SELECT @@SESSION.tx_isolation; -- MySQL 5.7 及更早版本
SELECT @@SESSION.transaction_isolation; -- MySQL 8.0 版本
```

查看全局（GLOBAL）事务隔离级别：

```
SELECT @@GLOBAL.tx_isolation; -- MySQL 5.7 及更早版本
SELECT @@GLOBAL.transaction_isolation; -- MySQL 8.0 版本
```

# 
